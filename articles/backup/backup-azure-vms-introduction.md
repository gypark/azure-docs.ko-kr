---
title: Azure VM 백업 정보
description: Azure VM 백업에 대해 알아보고 몇 가지 모범 사례를 확인합니다.
services: backup
author: rayne-wiselman
manager: carmonm
ms.service: backup
ms.topic: conceptual
ms.date: 03/04/2019
ms.author: raynew
ms.openlocfilehash: 93be913182db56941c346ef0cad47f70c0d614c9
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64706839"
---
# <a name="about-azure-vm-backup"></a>Azure VM 백업 정보

이 문서에서는 설명 하는 방법을 [Azure Backup 서비스](backup-introduction-to-azure-backup.md) Azure virtual machines (Vm)를 백업 합니다.

## <a name="backup-process"></a>백업 프로세스

어떻게 Azure Backup 백업을 완료 Azure Vm에 대 한 다음과 같습니다.

1. 백업에 대해 선택한 Azure Vm에 대 한 Azure Backup 시작에 지정 된 백업 일정에 따라 백업 작업을 합니다.
1. 첫 번째 백업 하는 동안 VM을 실행 하는 경우 백업 확장은 VM에 설치 됩니다.
    - Windows Vm에 대 한 합니다 _VMSnapshot_ 확장이 설치 되어 있습니다.
    - Linux Vm에 대 한 합니다 _VMSnapshotLinux_ 확장이 설치 되어 있습니다.
1. 실행 하는 Windows Vm에 대 한 백업을 사용 하 여 Windows VSS 볼륨 섀도 복사본 서비스 () vm 앱 일치 스냅숏을 조정 합니다.
    - 기본적으로 백업에는 전체 VSS 백업을 수행합니다.
    - 백업은 앱 일치 스냅숏을 사용할 수 없습니다, 하는 경우 다음 걸립니다 기본 저장소의 파일에 일관 된 스냅숏을 (발생 하기 때문에 응용 프로그램 쓰기가 없는 VM을 중지 하는 동안).
1. Linux Vm에 대 한 백업 파일 일치 백업을 수행 합니다. 앱 일치 스냅숏을 수동으로 사전/사후 스크립트를 사용자 지정 해야 합니다.
1. 백업 스냅숏을 생성 하면 후 자격 증명 모음에 데이터를 전송 합니다.
    - 백업이 동시에 각 VM 디스크를 백업 하 여 최적화 됩니다.
    - 백업 되는 각 디스크에 대 한 Azure 백업 디스크에 블록 및 식별 읽고 (델타) 이전 백업 이후에 변경 된 데이터 블록만 전송 합니다.
    - 스냅샷 데이터가 자격 증명 모음에 즉시 복사되지 않을 수 있습니다. 사용량이 많은 시간에는 몇 시간이 걸릴 수 있습니다. VM에 대 한 백업 시간을 총 일별 백업 정책의 24 시간 미만 됩니다.
 1. Azure Backup을 사용 하도록 설정 하는 Windows VM에 대 한 변경 내용은 다음과 같습니다.
    -   Microsoft Visual C++ 2013 Redistributable(x64)-12.0.40660 VM에 설치 된
    -   볼륨 섀도 복사본 서비스 (VSS) 수동에서 자동으로 변경의 시작 유형
    -   IaaSVmProvider Windows 서비스는 추가

1. 데이터 전송이 완료 되 면 스냅숏이 제거 되 고 복구 지점이 만들어집니다.

![Azure 가상 머신 백업 아키텍처](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

## <a name="encryption-of-azure-vm-backups"></a>Azure VM 백업의 암호화

Azure Backup을 사용하여 Azure VM을 백업하면 미사용 상태의 VM이 SSE(스토리지 서비스 암호화)를 사용하여 암호화됩니다. 또한 azure Backup은 Azure Disk Encryption을 사용 하 여 암호화 된 Azure Vm을 백업할 수 있습니다.

**암호화** | **세부 정보** | **지원**
--- | --- | ---
**Azure 디스크 암호화** | Azure 디스크 암호화 Azure Vm에 대 한 OS 및 데이터 디스크를 암호화합니다.<br/><br/> Azure Disk Encryption 비밀로 키 자격 증명 모음에서 보호 되는 BitLocker 암호화 키 (BEKs)와 통합 됩니다. Azure 디스크 암호화 Azure Key Vault 키 암호화 키 (Kek)와 통합 됩니다. | Azure Backup 또는 Kek 함께 BEKs BEKs만을 사용 하 여 암호화 하는 관리 및 관리 되지 않는 Azure Vm의 백업을 지원 합니다.<br/><br/> BEKs 및 Kek를 모두 백업 하 고 암호화 됩니다.<br/><br/> Kek 및 BEKs 백업, 때문에 필요한 권한 가진 사용자는 키를 복원할 수 있습니다 하 고 필요한 경우 key vault에 암호를 다시 합니다. 이러한 사용자는 암호화 된 VM을 복구할 수도 수 있습니다.<br/><br/> Azure 또는 권한이 없는 사용자가 암호화 된 키와 비밀을 읽을 수 없습니다.
**SSE** | SSE를 사용 하 여 Azure Storage는 자동으로 저장 하기 전에 데이터를 암호화 하 여 휴지 상태의 암호화를 제공 합니다. Azure Storage는 또한 검색 하기 전에 데이터를 해독 합니다. | Azure Backup에서는 Azure vm에서 미사용 암호화에 대 한 SSE를 사용합니다.

관리 및 관리 되지 않는 Azure Vm에 대 한 Backup만 BEKs로 암호화 된 Vm 또는 BEKs 함께 Kek로 암호화 된 Vm을 모두 지원 합니다.

백업 BEKs (비밀) 및 Kek (키) 암호화 됩니다. 읽기 및 해당 권한 있는 사용자가 키 자격 증명 모음으로 복원 하는 경우에 사용 될 수 있습니다. 권한이 없는 사용자가 아니고 Azure 읽기 하거나 백업 키 또는 암호를 사용할 수 있습니다.

BEKs도 백업 됩니다. 따라서는 BEKs가 손실 되 면 권한이 있는 사용자는 BEKs key vault로 복원 하 고 암호화 된 Vm을 복구할 수 있습니다. 필요한 권한 수준 가진 사용자만 백업 하 고 암호화 된 Vm 또는 키 및 비밀 복원 수 있습니다.

## <a name="snapshot-creation"></a>스냅샷 만들기

Azure 백업은 백업 일정에 따라 스냅숏을 사용합니다.

- **Windows Vm:** Windows Vm에 대 한 Backup 서비스는 VM 디스크의 앱 일치 스냅숏을 VSS를 사용 하 여 조정 합니다.

  - 기본적으로 Azure Backup은 전체 VSS 백업을 만듭니다. [자세히 알아보기](https://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx).
  - Azure Backup에는 VSS 복사본 백업을 사용 하 여 설정을 변경 하려면 명령 프롬프트에서 다음 레지스트리 키를 설정 합니다.

    **REG ADD "HKLM\SOFTWARE\Microsoft\BcdrAgent" /v USEVSSCOPYBACKUP /t REG_SZ /d TRUE /f**

- **Linux Vm:** Linux vm 앱 일치 스냅숏을 하려면 Linux 사전 스크립트를 사용 하 고 사후 스크립트 프레임 워크 일관성을 유지 하는 고유한 사용자 지정 스크립트를 작성할 합니다.

  - Azure Backup에는 사용자가 작성 한 사전/사후 스크립트만 호출 합니다.
  - 사전 스크립트 및 사후 스크립트를 성공적으로 실행 하는 경우 Azure Backup으로 응용 프로그램 일치 복구 지점을 표시 합니다. 그러나 사용자 지정 스크립트를 사용 하는 경우 라면 응용 프로그램 일관성을 담당 합니다.
  - [자세한](backup-azure-linux-app-consistent.md) 스크립트를 구성 하는 방법에 대 한 합니다.

### <a name="snapshot-consistency"></a>스냅샷 일관성

다음 표에서 다양 한 유형의 스냅숏 일관성을 보여 줍니다.

**스냅숏** | **세부 정보** | **복구** | **고려 사항**
--- | --- | --- | ---
**애플리케이션 일관성** | 앱 일관성이 있는 백업은 메모리 콘텐츠 및 보류 중인 I/O 작업을 캡처합니다. 앱 일치 스냅숏 백업을 수행 하기 전에 앱 데이터의 일관성을 유지 하도록 VSS 기록기 (또는 Linux에 대 한 사전/사후 스크립트)를 사용 합니다. | 앱 일치 스냅숏 사용 하 여 VM을 복구 하는 경우 VM 부팅 됩니다. 데이터 손상 또는 손실이 없습니다. 앱이 일관성 있는 상태로 시작됩니다. | Windows: 모든 VSS 기록기가 성공함<br/><br/> Linux: 사전/사후 스크립트가 구성 및 성공함
**파일 시스템 일치** | 파일 시스템 일치 백업을 동시에 모든 파일의 스냅숏을 수행 하 여 일관성을 제공 합니다.<br/><br/> | 파일 시스템 일치 스냅숏 사용 하 여 VM을 복구 하는 경우 VM 부팅 됩니다. 데이터 손상 또는 손실이 없습니다. 앱은 자체 “수정” 메커니즘을 구현하여 복원된 데이터가 일관성 있는지 확인해야 합니다. | Windows: 일부 VSS 기록기가 실패함 <br/><br/> Linux: 기본값 (있는 경우 사전/사후 스크립트는 구성 되지 않습니다 또는 실패)
**크래시 일관성** | 크래시 일치 스냅숏 백업 시 Azure VM을 종료 하는 경우에 일반적으로 발생 합니다. 백업 시 디스크에 이미 존재하는 데이터만 캡처 및 백업됩니다.<br/><br/> 크래시 일관성이 있는 복구 지점은 운영 체제 또는 앱의 데이터 일관성을 보장하지 않습니다. | 보장은 없습니다, 있지만 일반적으로 VM 부팅 되 면 및 손상 오류를 해결 하는 디스크 검사를 시작 합니다. 모든 메모리 내 데이터 또는 쓰기 작업 전송 되지 않은 충돌이 손실 되기 전에 디스크에 있습니다. 앱이 고유한 데이터 확인을 구현합니다. 예를 들어, 데이터베이스 앱을 인증에 대 한 해당 트랜잭션 로그를 사용할 수 있습니다. 트랜잭션 로그 데이터베이스에 없는 항목이 있으면 데이터 일치 될 때까지 다시 된 트랜잭션을 롤포워드하며 데이터베이스 소프트웨어입니다. | VM이 종료 상태

## <a name="backup-and-restore-considerations"></a>백업 및 복원 고려 사항

**고려 사항** | **세부 정보**
--- | ---
**디스크** | VM 디스크의 백업을 병렬입니다. 예를 들어 VM 4 개의 디스크가 있으면 Backup 서비스를 동시에 모든 4 개의 디스크를 백업 하려고 합니다. 백업은 증분 방식입니다(변경된 데이터만 백업).
**일정 계획** |  백업 사용량을 줄이기 위해 하루 중 서로 다른 시간에 여러 Vm을 백업 하 고 시간은 겹치지 않는지 확인 합니다. VM을 동시에 백업하면 트래픽 정체가 발생합니다.
**백업 준비** | 백업을 준비 하는 데 필요한 시간에 유의 하십시오. 준비 시간에는 설치 또는 백업 확장을 업데이트 하 고 백업 일정에 따라 스냅숏을 트리거한 포함 됩니다.
**데이터 전송** | Azure backup의 이전 백업에서 증분 변경 내용을 식별 하는 데 필요한 시간을 고려 합니다.<br/><br/> 증분 백업에 Azure Backup 결정 변경 된 블록의 체크섬을 계산 하 여 합니다. 블록이 변경 되 면 전송 자격 증명 모음에 표시 됩니다. 서비스는 더욱 전송할 데이터의 양을 최소화 하려고 식별 된 블록을 분석 합니다. 변경된 된 모든 블록을 평가한 후 Azure Backup 자격 증명 모음 변경 내용을 전송 합니다.<br/><br/> 스냅샷을 생성하는 시간과 자격 증명 모음으로 복사하는 시간 사이에 지연이 있을 수 있습니다.<br/><br/> 사용량이 많은 시간에 처리 해야 하는 백업에 대 한 최대 8 시간까지 걸릴 수 있습니다. VM에 대한 백업 시간은 일별 백업의 경우 24시간 미만입니다.
**초기 백업**: | 증분 백업에 대 한 총 백업 시간이 24 시간 보다 작은 경우에 첫 번째 백업에 대 한 사례 되지 않을 수 있습니다는. 초기 백업에 필요한 시간은 백업 처리 될 때 및 데이터의 크기에 따라 달라 집니다.
**복원 큐** | Azure 백업 프로세스를 동시에 여러 저장소 계정에서 작업을 복원 하 고 복원 요청이 큐에 넣습니다.
**복원 복사** | 복원 프로세스 동안 데이터가 자격 증명 모음에서 스토리지 계정으로 복사됩니다.<br/><br/> 총 복원에 저장소 계정의 처리량 (iops) 및 초당 I/O 작업에 따라 달라 집니다.<br/><br/> 복사 시간을 단축하려면 다른 애플리케이션 쓰기 및 읽기로 로드되지 않은 저장소 계정을 선택합니다.

### <a name="backup-performance"></a>Backup 성능

이러한 일반적인 시나리오는 전체 백업에 영향을 줄 수 있습니다.:

- **보호 된 Azure VM에 새 디스크를 추가 합니다.** VM를 다시 설정 하는 중 증분 백업 하 고 새 디스크 추가 되 면 백업 시간이 증가 합니다. 전체 백업에 기존 디스크의 델타 복제와 함께 새 디스크의 초기 복제로 인해 24 시간 넘게 지속 합니다.
- **조각화 된 디스크:** 백업 작업은 더 빠른 디스크 변경 내용이 연속 합니다. 변경 내용이 디스크 전체에 분산되고 조각화되면 백업이 더 느려집니다.
- **디스크 변동:** 증분 백업이 진행 되는 디스크를 보호 하는 경우 200GB 이상의의 일일 변동이 백업은 완료 (8 시간 이상) 시간이 오래 걸릴 수 있습니다.
- **백업 버전:** 백업 (즉시 복원을 버전 이라고 함)의 최신 변경 내용을 식별 하는 것에 대 한 체크섬 비교 보다 더 최적화 프로세스를 사용 합니다. 하지만 백업 체크섬 비교 전환 즉시 복원을 사용 하는 백업 스냅숏을 삭제 하는 경우. 이 경우 백업 작업은 24 시간을 초과 (또는 실패).

## <a name="best-practices"></a>모범 사례

VM 백업을 구성 하는 경우 다음이 사례를 따르는 것이 좋습니다.

- 정책에서 설정한 기본 일정을 수정 합니다. 예를 들어, 정책에서 기본 시간 12:00 AM 인 경우 증가 몇 분 정도 타이밍 리소스 최적으로 사용 되도록 합니다.
- Premium storage를 사용 하는 Vm의 백업에 대 한 것이 좋습니다 Azure Backup의 최신 버전을 실행 ([즉시 복원을](backup-instant-restore-capability.md)). 최신 버전을 실행 하지 하는 경우 백업 약 50%의 총 저장소 공간 할당 합니다. Backup 서비스에는 자격 증명 모음으로 전송 하 고 동일한 저장소 계정에 스냅숏을 복사할이 공간이 필요 합니다.
- Vm에서 단일 자격 증명 모음에서 복원 하는 경우 좋습니다를 사용 하는 다른 [범용 v2 저장소 계정을](https://docs.microsoft.com/azure/storage/common/storage-account-upgrade) 대상 저장소 계정에 제한 상황이 하지 확인 합니다. 예를 들어, 각 VM을 다른 저장소 계정이 있어야 합니다. 예를 들어 10 개의 Vm을 복원 하는 경우에 10 개의 다른 저장소 계정을 사용 합니다.
- 범용 v1 저장소 계층 (snapshot)에서 복원은 동일한 저장소 계정에 스냅숏 이므로 몇 분 안에 완료 됩니다. 범용 v2 저장소 계층 (자격 증명 모음)에서 복원 시간이 걸릴 수 있습니다. 데이터를 범용 v1 저장소에서 사용할 수 있는 경우에 사용 하는 권장 합니다 [즉시 복원을](backup-instant-restore-capability.md) 빠른 복원을 수행 하는 기능입니다. (자격 증명 모음에서 데이터를 복원 해야, 있는 경우 다음 더 많은 시간이 걸립니다.)
- 저장소 계정당 디스크 수 한도 디스크 (IaaS) VM 서비스 인프라에서 실행 되는 응용 프로그램에서 액세스 되는 얼마나 많이 상대적입니다. 일반적으로 디스크 5 ~ 10 개 이상의 단일 저장소 계정에 있는 경우 저장소 계정이 일부 디스크를 이동 하 여 부하를 분산 합니다.

## <a name="backup-costs"></a>백업 비용

Azure Backup으로 백업된 Azure VM에는 [Azure Backup 가격 책정](https://azure.microsoft.com/pricing/details/backup/)이 적용됩니다.

청구는 첫 번째 성공적인 백업 완료 될 때까지 시작 되지 않습니다. 이때 스토리지와 보호된 인스턴스 둘 다에 대한 요금 청구가 시작됩니다. VM에 대 한 모든 백업 데이터가 자격 증명 모음에 저장 됩니다으로 계속 청구가 됩니다. VM에 대한 보호를 중지하지만, 자격 증명 모음에 VM에 대한 백업 데이터가 있는 경우 요금은 계속 청구됩니다.

지정된 VM에 대한 요금 청구는 보호가 중지되고 모든 백업 데이터가 삭제된 경우에만 중단됩니다. 보호가 중지되고 활성 백업 작업이 없으면 마지막으로 성공한 VM 백업이 월별 청구에 사용되는 보호된 인스턴스 크기가 됩니다.

보호 된 인스턴스의 크기 계산에 기반 합니다 *실제* VM의 크기입니다. VM의 크기는 임시 저장소 제외 하 고 VM에서 모든 데이터의 합계입니다. 가격에 데이터 디스크에 저장, 없습니다 최대 지원 크기는 VM에 연결 된 각 데이터 디스크에 대 한 실제 데이터를 기반으로 합니다.

마찬가지로, 백업 저장소 요금이 각 복구 지점의 실제 데이터의 합계는 Azure Backup에 저장 된 데이터의 크기는 기반으로 합니다.

예를 들어 각 4TB의 최대 크기를 사용 하 여 두 개의 추가 데이터 디스크가 있는 A2 표준 크기의 VM을 이동 합니다. 다음 표에서 각이 디스크에 저장 된 실제 데이터를 보여 줍니다.

**디스크** | **최대 크기** | **표시되는 실제 데이터**
--- | --- | ---
OS 디스크 | 4,095GB | 17GB
로컬/임시 디스크 | 135GB | 5GB(백업에 포함되지 않음)
데이터 디스크 1 | 4,095GB | 30GB
데이터 디스크 2 | 4,095GB | 0GB

이 경우 VM의 실제 크기는 17GB+30GB+0GB=47GB입니다. 이 보호 된 인스턴스 크기 (47GB)는 월별 청구서의 근거가 됩니다. VM에서 데이터의 양이 증가 함에 따라 보호 된 인스턴스 크기에 맞게 청구 변경 내용에 대 한 사용.

## <a name="next-steps"></a>다음 단계

그렇다면 [Azure VM 백업에 대 한 준비](backup-azure-arm-vms-prepare.md)합니다.
