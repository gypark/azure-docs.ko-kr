---
title: Azure Cosmos DB의 고가용성
description: 이 문서에서는 Azure Cosmos DB에서 고가용성을 제공하는 방법을 설명합니다.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 05/29/2019
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: 74eee3d164e7ee3831f292568da9cf0620e576e5
ms.sourcegitcommit: d89032fee8571a683d6584ea87997519f6b5abeb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/30/2019
ms.locfileid: "66399296"
---
# <a name="high-availability-with-azure-cosmos-db"></a>Azure Cosmos DB의 고가용성

Azure Cosmos DB는 Cosmos 계정과 연결된 모든 Azure 지역에서 데이터를 투명하게 복제합니다. Cosmos DB는 다음 이미지와 같이 데이터에 대해 여러 계층의 중복성을 사용합니다.

![물리적 분할](./media/high-availability/cosmosdb-data-redundancy.png)

- Cosmos 컨테이너 내에서 데이터가 [수평 분할 된](partitioning-overview.md)합니다.

- 각 지역 내에서 모든 파티션은 모든 쓰기가 복제되는 복제본 세트로 보호되며, 대부분의 복제본에서 지속적으로 커밋됩니다. 복제본은 10 ~ 20개의 장애 도메인 간에 분산됩니다.

- 모든 지역에 걸쳐 있는 각 파티션이 복제됩니다. 각 지역에서는 Cosmos 컨테이너의 모든 데이터 파티션을 포함하며, 쓰기를 허용하고 읽기를 제공할 수 있습니다.  

Cosmos 계정의 분산 되는 경우 *N* Azure 지역에 있을 것 이상 *N* 모든 데이터 복사본 4 x입니다. 대기 시간이 짧은 데이터 액세스를 제공 하 고 Cosmos 계정과 연결 된 지역에서 쓰기/읽기 처리량을 크기 조정 하는 것 외에도 있는 더 많은 지역 (상위 *N*) 가용성을 더 향상 시킵니다.  

## <a name="slas-for-availability"></a>가용성 SLA

전역적으로 분산된 데이터베이스인 Cosmos DB는 처리량, 99번째 백분위수의 대기 시간, 일관성 및 고가용성을 포함하는 포괄적인 SLA를 제공합니다. 다음 표에서는 Cosmos DB가 제공하는 단일 및 다중 지역 계정에 대한 고가용성 보장 내용을 보여줍니다. 고가용성을 위해 항상 여러 쓰기 지역을 Cosmos 계정을 구성 합니다.

|작업 유형  | 단일 지역 |다중 지역(단일 지역 쓰기)|다중 지역(다중 지역 쓰기) |
|---------|---------|---------|-------|
|Writes    | 99.99    |99.99   |99.999|
|Reads     | 99.99    |99.999  |99.999|

> [!NOTE]
> 실제로 제한 된 부실, 세션, 일관적인 접두사 및 최종 일관성 모델에 대 한 실제 쓰기 가용성은 게시 된 Sla 보다 훨씬 높습니다. 모든 일관성 수준에 대한 실제 읽기 가용성은 게시된 SLA보다 훨씬 높습니다.

## <a name="high-availability-with-cosmos-db-in-the-event-of-regional-outages"></a>지역 가동 중단 발생 시 Cosmos DB를 사용 하 여 높은 가용성

지역 가동 중단 흔한 및 Azure Cosmos DB 데이터베이스는 항상 항상 사용할 수 있도록 합니다. 다음 세부 정보를 Cosmos 계정 구성에 따라 가동 중단이 발생 하는 동안 Cosmos DB 동작을 캡처합니다.

- Cosmos DB를 사용하면 쓰기 작업이 클라이언트에서 승인되기 전에 쓰기 작업을 허용하는 지역 내에서 복제본의 쿼럼에 의해 데이터가 지속적으로 커밋됩니다.

- 다중 쓰기 지역으로 구성된 다중 지역 계정은 쓰기 및 읽기 모두에 대해 고가용성을 유지합니다. 지역별 장애 조치(failover)는 즉각적이며, 애플리케이션에서 변경할 필요가 없습니다.

- **단일 쓰기 지역 (쓰기 지역 가동 중단)를 사용 하 여 다중 지역 계정:** 쓰기 지역 중단 동안 이러한 계정은 읽기에 대해 고가용성을 유지합니다. 그러나 쓰기 작업에 대해 수행 해야 합니다 **"자동 장애 조치를 사용 하도록 설정"** 프로그램 Cosmos에 계정을 장애 조치의 영향을 받는 지역을 다른 지역으로 합니다. 장애 조치는 지정한 지역 우선 순위에 따라 발생합니다. 지역이 다시 온라인 상태가 되 면 영향을 받는 쓰기 지역 가동 중단 중에 복제 되지 않은 데이터를 통해 사용할 수는 [충돌 피드](how-to-manage-conflicts.md#read-from-conflict-feed)합니다. 응용 프로그램은 충돌 피드 응용 프로그램별 논리에 따라 충돌을 해결 하 고 적절 하 게 Cosmos 컨테이너에 업데이트 된 데이터를 다시 작성 읽을 수 있습니다. 이전에 영향을 받는 쓰기 지역이 복구되고 나면, 자동으로 읽기 지역으로 사용할 수 있게 됩니다. 수동 장애 조치(failover)를 호출하고 영향을 받는 지역을 쓰기 지역으로 구성할 수 있습니다. 다시 사용 하 여 수동 장애 조치를 수행할 수 있습니다 [Azure CLI 또는 Azure portal](how-to-manage-database-account.md#manual-failover)합니다. 수동 장애 조치(Failover) 이전, 도중 또는 이후에는 **데이터 또는 가용성 손실**이 없습니다. 애플리케이션은 고가용성을 계속 유지합니다. 

- **단일 쓰기 지역 (읽기 지역 가동 중단)를 사용 하 여 다중 지역 계정:** 읽기 지역 중단 동안 이러한 계정은 읽기 및 쓰기에 대해 고가용성을 유지합니다. 영향을 받는 지역은 쓰기 지역에서 자동으로 연결이 해제되며 오프라인으로 표시됩니다. 합니다 [Cosmos DB Sdk](sql-api-sdk-dotnet.md) 리디렉션 읽기는 기본 지역 목록에서 사용 가능한 다음 지역으로 호출 합니다. 기본 지역 목록의 어느 지역도 사용할 수 없는 경우 호출은 현재 쓰기 지역으로 자동으로 대체됩니다. 읽기 지역 중단을 처리하기 위해 애플리케이션 코드를 변경할 필요가 없습니다. 결국 영향을 받은 지역이 다시 온라인 상태가 되면 이전에 영향을 받은 읽기 지역이 현재 쓰기 지역과 자동으로 동기화되고 읽기 요청을 제공하는 데 다시 사용할 수 있게 됩니다. 후속 읽기는 애플리케이션 코드를 변경하지 않고도 복구된 지역으로 리디렉션됩니다. 모두 장애 조치를 이전에 실패 한 영역에 다시 참여 하는 동안 일관성 보장 계속 Cosmos DB에 의해 적용 되는 것을 읽습니다.

- 단일 지역 계정은 지역 중단으로 인해 가용성이 손실될 수도 있습니다. 것이 좋습니다 설정 하기 위해 **두 개 이상의 지역** (가급적 둘 이상의 쓰기 지역) 모든 시간에 고가용성을 보장 하기 위해 Cosmos 계정과 합니다.

- 기에 드물게 발생 하며 부적절 한 이벤트는 Azure 지역을 영구적으로 복구할 수 없는 경우 데이터 손실 없이 다중 지역 Cosmos 계정의 기본 일관성 수준을 사용 하 여 구성 된 경우 *강력한*합니다. 잠재적인 데이터 손실 기간 제한 된 부실 일관성으로 구성 된 다중 지역 Cosmos 계정에 대 한 영구적으로 복구할 수 없는 쓰기 지역, 시 항상 부실 창으로 제한 됩니다 (*K* 또는*T*); 세션, 일관적인 접두사 및 최종 일관성 수준에 대 한 잠재적인 데이터 손실 기간을 최대 5 초 제한 됩니다. 

## <a name="availability-zone-support"></a>가용성 영역 지원

Azure Cosmos DB는 지역 가동 중단 중 높은 가용성과 복원 력을 제공 하는 다중 마스터 전역으로 분산된 데이터베이스 서비스입니다. 또한 영역 복원 력 간 설정할 수 있습니다. 이제 **중복성 영역** Azure Cosmos 데이터베이스를 사용 하 여 연결 하는 영역을 선택 하는 경우. 

가용성 영역 지원을 통해 Azure Cosmos DB는 영역 장애 시 고가용성과 복원 력이 제공 하는 지정 된 영역 내에서 여러 영역에서 복제본이 배치 되 확인 합니다. 대기 시간 및이 구성에서 다른 Sla를 변경 하지 않고 있습니다. 단일 영역 장애, 영역 중복 제공 RPO 통한 전체 데이터 지 속성 이벤트 = 0, RTO 사용 하 여 가용성 = 0. 

영역 중복은는 *추가 기능* 에 [다중 마스터 복제](how-to-multi-master.md) 기능입니다. 단독으로 영역 중복 지역 복원 력을 달성에 의존할 수 없습니다. 예를 들어 지역 가동 중단 또는 지역에서 대기 시간이 짧은 액세스 시는 것이 좋습니다 영역 중복 하는 것 외에도 여러 쓰기 지역에 있어야 합니다. 

Azure Cosmos 계정에 대 한 다중 지역 쓰기를 구성할 때 없이 영역 중복성을 선택할 수 있습니다 추가 비용입니다. 그렇지 않은 경우 영역 중복 지원에 대 한 가격 책정에 대 한 아래의 참고를 참조 하세요. 영역을 제거 하는 영역 중복을 사용 하 여 다시 추가 하 여 영역 중복 Azure Cosmos 계정의 기존 영역에서 사용할 수 있습니다.

이 기능은 다음과 같은 Azure 지역에서 사용할 수 있습니다.

* 영국 남부
* 동남아시아 

> [!NOTE] 
> 단일 하위 지역 Azure Cosmos 계정에 대 한 가용성 영역을 사용 하도록 설정 하면 해당 계정에 추가 영역을 추가 하는 요금이 발생 합니다. 가격 책정 세부 정보를 참조 하세요.는 [가격 책정 페이지](https://azure.microsoft.com/pricing/details/cosmos-db/) 하며 [Azure Cosmos DB의 다중 지역 비용](optimize-cost-regions.md) 문서입니다. 

다음 표에서 다양 한 계정 구성의 고가용성 기능을 보여 줍니다. 

|KPI  |가용성 영역 (비-AZ) 없이 단일 지역  |가용성 영역 (AZ)를 사용 하 여 단일 지역  |가용성 영역 (AZ, 2 개 하위 지역이) – 가장 권장 설정을 사용 하 여 다중 지역 |
|---------|---------|---------|---------|
|쓰기 가용성 SLA     |   99.99%      |    99.99%     |  99.999%  |
|가용성 SLA 읽기   |   99.99%      |   99.99%      |  99.999%       |
|가격  |  단일 지역에 대 한 요율 정보 |  단일 지역 가용성 영역에 대 한 요율 정보 |  다중 지역에 대 한 요율 정보       |
|영역 오류 – 데이터 손실   |  데이터 손실  |   데이터 손실 없음 |   데이터 손실 없음  |
|영역 오류-가용성 |  가용성이 손실  | 가용성 손실 없음  |  가용성 손실 없음  |
|읽기 대기 시간    |  지역 간    |   지역 간   |    낮음  |
|쓰기 대기 시간    |   지역 간   |  지역 간    |   낮음   |
|지역 가동 중단 – 데이터 손실    |   데이터 손실      |  데이터 손실       |   데이터 손실 <br/><br/> 사용 하 여 제한 된 부실 일관성 다중 마스터와 여러 지역에 있는 경우 데이터 손실은 계정에 구성 된 제한 된 부실으로 제한 됩니다. <br/><br/> 여러 지역으로 강력한 일관성을 구성 하 여 지역 가동 중단 시 데이터 손실을 방지할 수 있습니다. 이 옵션은 가용성 및 성능에 영향을 주는 장단점 포함 되어 있습니다.      |
|지역 가동 중단-가용성  |  가용성이 손실       |  가용성이 손실       |  가용성 손실 없음  |
|처리량    |  처리량을 프로 비전 된 RU/s X      |  처리량을 프로 비전 된 RU/s X       |  RU/s 프로 비전 된 처리량 2x <br/><br/> 이 구성 모드에서는 두 지역에 있기 때문에 가용성 영역을 사용 하 여 단일 지역을 비교할 때 처리량의 두 배입니다.   |

새 또는 기존 Azure Cosmos 계정에 지역을 추가 하는 경우 영역 중복을 설정할 수 있습니다. 현재 PowerShell 또는 Azure Resource Manager 템플릿을 사용 하 여 영역 중복을 사용할 수 있습니다. Azure Cosmos 계정의 영역 중복을 사용 하도록 설정 하려면 설정 해야 합니다 `isZoneRedundant` 플래그를 `true` 특정 위치에 대 한 합니다. 위치 속성 내에서이 플래그를 설정할 수 있습니다. 예를 들어, 다음 powershell 코드 조각은 "동남 아시아" 지역에 대 한 영역 중복을 수 있습니다.

```powershell
$locations = @( 
    @{ "locationName"="Southeast Asia"; "failoverPriority"=0; "isZoneRedundant"= "true" }, 
    @{ "locationName"="East US"; "failoverPriority"=1 } 
) 
```

## <a name="building-highly-available-applications"></a>고가용성 애플리케이션 빌드

- 높은 쓰기 및 읽기 가용성을 보장하려면 여러 쓰기 지역을 사용하여 두 개 이상의 지역을 포괄하도록 Cosmos 계정을 구성합니다. 가장 높은 가용성, 낮은 대기 시간,이 구성을 제공할 것 이며 모두에 대 한 최상의 확장성을 읽고 쓰는 Sla로 지원. 자세한 내용은 [다중 쓰기 지역으로 Cosmos 계정을 구성하는 방법](tutorial-global-distribution-sql-api.md)을 참조하세요.

- 단일 쓰기 지역으로 구성된 다중 지역 Cosmos 계정의 경우 [Azure CLI 또는 Azure Portal을 사용하여 자동 장애 조치를 사용하도록 설정](how-to-manage-database-account.md#automatic-failover)합니다. 자동 장애 조치(failover)를 사용하도록 설정하면, Cosmos DB는 지역 재해가 있을 때마다 자동으로 사용자 계정을 장애 조치(failover)합니다.  

- Cosmos 계정의 가용성이 높더라도 애플리케이션이 고가용성을 유지하도록 올바르게 설계되지 않았을 수도 있습니다. 응용 프로그램의 종단 간 고가용성을 테스트 하려면 주기적으로 호출 합니다 [Azure CLI 또는 Azure portal을 사용 하 여 수동 장애 조치](how-to-manage-database-account.md#manual-failover), 응용 프로그램 테스트 또는 재해 복구 (DR)의 일부로 드릴 합니다.

- 전역적으로 분산 된 데이터베이스 환경 내에서 있는 전체 지역 가동 중단 시 일관성 수준 및 데이터 지 속성 간의 직접 관계가입니다. 비즈니스 연속성 계획을 개발할 때는 중단 이벤트가 발생한 후 애플리케이션이 완전히 복구되기까지 허용되는 최대 시간을 이해해야 합니다. 애플리케이션을 완전히 복구하는 데 필요한 시간을 RTO(복구 시간 목표)라고 합니다. 또한 중단 이벤트가 발생한 후 복구될 때 애플리케이션에서 손실을 허용할 수 있는 최근 데이터 업데이트의 최대 기간도 이해해야 합니다. 손실될 수 있는 업데이트 기간을 RPO(복구 지점 목표)라고 합니다. Azure Cosmos DB의 RPO 및 RTO를 확인하려면 [일관성 수준 및 데이터 내구성](consistency-levels-tradeoffs.md#rto)을 참조하세요.

## <a name="next-steps"></a>다음 단계

이제 다음 문서를 읽을 수 있습니다.

* [다양한 일관성 수준의 가용성 및 성능 절충](consistency-levels-tradeoffs.md)
* [전역적으로 프로비전된 처리량 크기 조정](scaling-throughput.md)
* [글로벌 배포 - 내부 살펴보기](global-dist-under-the-hood.md)
* [Azure Cosmos DB의 일관성 수준](consistency-levels.md)
* [Cosmos 계정의 여러 쓰기 지역으로 구성 하는 방법](how-to-multi-master.md)
