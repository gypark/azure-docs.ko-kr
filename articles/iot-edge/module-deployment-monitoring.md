---
title: 디바이스 그룹에 대한 자동 배포 - Azure IoT Edge | Microsoft Docs
description: Azure IoT Edge에서 자동 배포를 사용하여 공유 태그를 기준으로 디바이스 그룹 관리
author: kgremban
manager: philmea
ms.author: kgremban
ms.date: 09/27/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: 376ee74732daf526b31129fa8c93cbaa32350eae
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/23/2019
ms.locfileid: "60318209"
---
# <a name="understand-iot-edge-automatic-deployments-for-single-devices-or-at-scale"></a>단일 디바이스 또는 대규모 IoT Edge 자동 배포 이해

Azure IoT Edge 디바이스는 다른 유형의 IoT 디바이스와 비슷한 [디바이스 수명 주기](../iot-hub/iot-hub-device-management-overview.md)를 따릅니다.

1. OS가 있는 디바이스를 이미징하고 [IoT Edge 런타임](iot-edge-runtime.md)을 설치하여 새 IoT Edge 디바이스를 프로비전합니다.
2. [IoT Edge 모듈](iot-edge-modules.md)을 실행하도록 디바이스를 구성한 다음, 디바이스 상태를 모니터링합니다. 
3. 마지막으로 디바이스가 교체되거나 오래되면 디바이스 사용을 중지합니다.  

Azure IoT Edge는 IoT Edge 디바이스에서 실행되도록 모듈을 구성하는 두 가지 방법을 제공합니다. 하나는 Azure IoT Edge [자습서](tutorial-deploy-function.md)에서 이 방법을 사용한 단일 디바이스에서 개발 및 빠른 반복을 위한 것이고, 다른 하나는 대규모 IoT Edge 디바이스를 관리하기 위한 것입니다. 이러한 두 가지 방법은 Azure Portal에서 프로그래밍 방식으로 사용할 수 있습니다. 대상 그룹 또는 많은 수의 디바이스의 경우 디바이스 쌍에서 [태그](../iot-edge/how-to-deploy-monitor.md#identify-devices-using-tags)를 사용하여 모듈을 배포하려는 디바이스를 지정할 수 있습니다. 다음 단계에서는 태그 속성을 통해 식별되는 워싱턴 주의 디바이스 그룹에 배포하는 방법을 설명합니다. 

이 아티클에서는 IoT Edge 자동 배포라고 하는 대규모 디바이스에 대한 구성 및 모니터링 단계에 대해 집중적으로 설명합니다. 전체 배포 단계는 다음과 같습니다. 

1. 운영자가 대상 디바이스뿐만 아니라 일단의 모듈을 설명하는 배포를 정의합니다. 각 배포에는 이 정보를 반영하는 배포 매니페스트가 있습니다. 
2. IoT Hub 서비스는 모든 대상 디바이스와 통신하여 원하는 모듈로 구성합니다. 
3. IoT Hub 서비스는 IoT Edge 디바이스에서 상태를 검색하여 운영자에게 제공합니다.  예를 들어 운영자는 Edge 디바이스가 성공적으로 구성되지 않았거나 런타임 중에 모듈이 실패한 경우를 확인할 수 있습니다. 
4. 언제든지 대상 조건에 맞는 새 IoT Edge 디바이스가 배포되도록 구성됩니다. 예를 들어 새 IoT Edge 디바이스가 프로비전되고 워싱턴주 디바이스 그룹에 추가되면, 워싱턴주에 있는 모든 IoT Edge 디바이스를 대상으로 하는 배포가 자동으로 구성됩니다. 
 
이 문서에서는 배포 구성 및 모니터링과 관련된 각 구성 요소를 설명합니다. 배포 만들기 및 업데이트에 대한 연습은 [대규모 IoT Edge 모듈 배포 및 모니터링](how-to-deploy-monitor.md)을 참조하세요.

## <a name="deployment"></a>배포

IoT Edge 자동 배포는 대상 IoT Edge 디바이스 집합에서 인스턴스로 실행되도록 IoT Edge 모듈 이미지를 할당합니다. 이는 해당 초기화 매개 변수가 있는 모듈의 목록을 포함하도록 IoT Edge 배포 매니페스트를 구성하여 작동합니다. 배포는 단일 디바이스(디바이스 ID 기반) 또는 디바이스 그룹(태그 기반)에 할당할 수 있습니다. IoT Edge 디바이스는 배포 매니페스트를 받은 후 해당 컨테이너 리포지토리에서 컨테이너 이미지를 다운로드하고 설치한 다음 적절하게 구성합니다. 배포가 만들어지면 운영자가 배포 상태를 모니터링하여 대상 디바이스가 제대로 구성되었는지 확인할 수 있습니다.

IoT Edge 디바이스만 배포를 사용하여 구성할 수 있습니다. 배포를 수신하기 전에 다음 필수 구성 요소가 디바이스에 있어야 합니다.

* 기본 운영 체제
* Moby 또는 Docker와 같은 컨테이너 관리 시스템
* IoT Edge 런타임 프로비전 

### <a name="deployment-manifest"></a>배포 매니페스트

배포 매니페스트는 대상 IoT Edge 디바이스에 구성할 모듈을 설명하는 JSON 문서입니다. 여기에는 필요한 시스템 모듈(특히 IoT Edge 에이전트 및 IoT Edge 허브)을 포함하여 모든 모듈에 대한 구성 메타데이터가 포함되어 있습니다.  

각 모듈의 구성 메타데이터에는 다음 항목이 포함됩니다. 

* Version 
* Type 
* 상태(예: 실행 중 또는 중지됨) 
* 다시 시작 정책 
* 이미지 및 컨테이너 레지스트리
* 데이터 입력 및 출력 경로 

모듈 이미지가 프라이빗 컨테이너 레지스트리에 저장된 경우 IoT Edge 에이전트는 레지스트리 자격 증명을 보관합니다. 

### <a name="target-condition"></a>대상 조건

대상 조건은 배포의 수명 내내 지속적으로 평가 됩니다. 요구 사항을 충족하는 새 디바이스가 모두 포함되고, 더 이상 요구 사항을 충족하지 않는 기존 디바이스는 제거됩니다. 서비스에서 대상 조건 변경을 탐지하면 배포가 다시 활성화됩니다. 

예를 들어 배포 A의 대상 조건이 tags.environment = 'prod'인 경우 다시 활성화됩니다. 배포를 시작할 때는 10개의 프로덕션 디바이스가 있습니다. 이 10개 디바이스에 모듈이 성공적으로 설치됩니다. IoT Edge 에이전트 상태는 총 10개 디바이스, 성공한 응답 10개, 실패한 응답 0개, 보류 중인 응답 0개로 표시됩니다. 이제 tags.environment = 'prod'인 디바이스 5개를 추가합니다. 새 디바이스 5개에 배포하려고 시도하면 서비스에서 변경을 감지하고 IoT Edge 에이전트 상태는 총 15개 디바이스, 성공한 응답 10개, 실패한 응답 0개. 보류 중인 응답 5개가 됩니다.

디바이스 쌍 태그 또는 deviceId에 부울 조건을 사용하여 대상 디바이스를 선택합니다. 태그가 있는 조건을 사용하려면 속성과 동일한 수준의 디바이스 쌍에 "tags":{} 섹션을 추가해야 합니다. [디바이스 쌍의 태그에 대해 자세히 알아보기](../iot-hub/iot-hub-devguide-device-twins.md)

대상 조건 예:

* deviceId ='linuxprod1'
* tags.environment ='prod'
* tags.environment = 'prod' AND tags.location = 'westus'
* tags.environment = 'prod' OR tags.location = 'westus'
* tags.operator = 'John' AND tags.environment = 'prod' NOT deviceId = 'linuxprod1'

대상 조건을 생성할 때 다음과 같은 몇 가지 제약 조건이 있습니다.

* 디바이스 쌍에서 태그 또는 deviceId를 사용하여 대상 조건만 작성할 수 있습니다.
* 큰따옴표는 대상 조건의 어떤 부분에도 허용되지 않습니다. 작은따옴표를 사용합니다.
* 작은따옴표는 대상 조건의 값을 나타냅니다. 따라서 작은따옴표가 디바이스 이름의 일부인 경우 또 다른 작은따옴표로 작은따옴표를 이스케이프해야 합니다. 예를 들어 `operator'sDevice`라는 디바이스를 대상으로 지정하려면 `deviceId='operator''sDevice'`라고 씁니다.
* 숫자, 문자 및 특수 문자(`-:.+%_#*?!(),=@;$`)는 대상 조건 값에 사용할 수 있습니다.

### <a name="priority"></a>우선 순위

우선 순위는 배포가 다른 배포를 기준으로 대상 디바이스에 적용되어야 하는지 여부를 정의합니다. 배포 우선 순위는 양의 정수이며, 큰 숫자는 높은 우선 순위를 나타냅니다. IoT Edge 디바이스가 둘 이상의 배포 대상이 되는 경우 우선 순위가 가장 높은 배포가 적용됩니다.  우선 순위가 낮은 배포는 적용되지 않으며 병합되지 않습니다.  디바이스가 동등한 우선 순위를 갖는 둘 이상의 배포 대상으로 지정되면 가장 최근에 만든 배포(생성 타임스탬프 기준으로 결정됨)가 적용됩니다.

### <a name="labels"></a>레이블 

레이블은 배포를 필터링하고 그룹화하는 데 사용할 수 있는 문자열 키/값 쌍입니다. 배포에는 여러 개의 레이블이 있을 수 있습니다. 레이블은 선택 사항이며, IoT Edge 디바이스의 실제 구성에는 아무런 영향을 주지 않습니다. 

### <a name="deployment-status"></a>배포 상태

배포를 모니터링하여 모든 대상 IoT Edge 디바이스에 성공적으로 적용되었는지 여부를 확인할 수 있습니다.  대상 Edge 디바이스는 다음 상태 범주 중 하나 이상에 표시됩니다. 

* **대상**: 배포 대상 조건과 일치하는 IoT Edge 디바이스가 표시됩니다.
* **실제**: 더 높은 우선 순위의 다른 배포에서 대상으로 지정하지 않은 대상 IoT Edge 디바이스가 표시됩니다.
* **정상**: 모듈이 성공적으로 배포되었다고 서비스에 다시 보고한 IoT Edge 디바이스가 표시됩니다. 
* **비정상**: 하나 이상의 모듈이 성공적으로 배포되지 않았다고 서비스에 다시 보고한 IoT Edge 디바이스가 표시됩니다. 오류를 자세히 조사하려면 해당 디바이스에 원격으로 연결하고 로그 파일을 살펴봅니다.
* **알 수 없음**: 이 배포와 관련된 모든 상태를 보고하지 않은 IoT Edge 디바이스가 표시됩니다. 자세히 조사하려면 서비스 정보 및 로그 파일을 살펴봅니다.

## <a name="phased-rollout"></a>단계별 배포 

단계별 배포는 운영자가 대규모 IoT Edge 디바이스 집합에 변경 내용을 배포하는 전체적인 프로세스입니다. 목표는 점진적으로 변경하여 광범위한 새로운 변경에 따른 위험을 줄이는 것입니다.  

단계별 배포는 다음과 같은 단계로 실행됩니다. 

1. IoT Edge 디바이스를 프로비전하고 `tag.environment='test'`와 같이 디바이스 쌍 태그를 설정하여 해당 디바이스의 테스트 환경을 설정합니다. 테스트 환경은 배포에서 최종적인 대상이 되는 프로덕션 환경을 미러링해야 합니다. 
2. 원하는 모듈 및 구성이 포함된 배포를 만듭니다. 대상 조건은 IoT Edge 디바이스 테스트 환경을 대상으로 해야 합니다.   
3. 테스트 환경에서 새 모듈 구성의 유효성을 검사합니다.
4. 대상 조건에 새 태그를 추가하여 프로덕션 IoT Edge 디바이스의 하위 집합이 포함되도록 배포를 업데이트합니다. 또한 배포 우선 순위가 현재의 해당 디바이스를 대상으로 하는 다른 배포보다 더 높은지 확인합니다 
5. 배포 상태를 확인하여 대상 IoT 디바이스에 대한 배포가 성공했는지 확인합니다.
6. 나머지 모든 프로덕션 IoT Edge 디바이스를 대상으로 지정하도록 배포를 업데이트합니다.

## <a name="rollback"></a>롤백

오류 또는 잘못된 구성이 표시되면 배포를 롤백할 수 있습니다.  배포는 IoT Edge 디바이스에 대한 절대적인 모듈 구성을 정의하므로, 모든 모듈을 제거하는 것이 목표인 경우에도 우선 순위가 낮은 동일한 디바이스에 추가 배포를 대상으로 지정해야 합니다.  

롤백을 수행하는 순서는 다음과 같습니다. 

1. 동일한 디바이스 집합에도 추가 배포가 대상으로 지정되었는지 확인합니다. 롤백의 목표가 모든 모듈을 제거하는 것이면 추가 배포에 모듈이 포함되면 안됩니다. 
2. 디바이스가 더 이상 대상 조건을 충족하지 못하도록 롤백하려는 배포의 대상 조건식을 수정하거나 제거합니다.
3. 배포 상태를 확인하여 롤백이 성공했는지 확인합니다.
   * 롤백된 배포에는 더 이상 롤백된 디바이스의 상태가 표시되지 않아야 합니다.
   * 이제 추가 배포에는 롤백된 디바이스의 배포 상태가 포함됩니다.


## <a name="next-steps"></a>다음 단계

* [대규모 IoT Edge 모듈 배포 및 모니터링](how-to-deploy-monitor.md)에서 배포를 생성, 업데이트 또는 삭제하는 단계를 연습합니다.
* [IoT Edge 런타임](iot-edge-runtime.md) 및 [IoT Edge 모듈](iot-edge-modules.md)과 같은 다른 IoT Edge 개념에 대해 자세히 알아봅니다.

